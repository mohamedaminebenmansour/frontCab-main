<!-- Alert Message -->
<div *ngIf="alertMessage"
     class="flex justify-between items-center px-4 py-3 mb-6 rounded transition-all"
     [ngClass]="{
       'bg-green-500 text-white': alertType === 'success',
       'bg-red-500 text-white': alertType === 'error'
     }">
  <span>{{ alertMessage }}</span>
  <button (click)="alertMessage = null; alertType = null" class="ml-4 font-bold">âœ–</button>
</div>

<!-- Header -->
<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
  <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2 sm:mb-0">Storage Bins</h1>
  <button (click)="toggleForm()"
          class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">
    {{ isFormVisible ? 'Cancel' : 'Add New Storage Bin' }}
  </button>
</div>

<!-- Form -->
<form *ngIf="isFormVisible" (ngSubmit)="saveBin()" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 bg-gray-50 p-6 rounded-lg shadow">
  <div>
    <label class="block text-sm font-medium text-gray-700">Lib Code Location</label>
    <input [(ngModel)]="selectedBin.ewm_Lib_CodeLocation" name="ewm_Lib_CodeLocation"
           class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
           placeholder="Enter lib code location" required>
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700">Code Location Groupe</label>
    <select [(ngModel)]="selectedBin.codeLocationGroupe" name="codeLocationGroupe"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      <option value="">Select Location Groupe</option>
      <option *ngFor="let group of binGroups" [value]="group.codeLocationGroupe">
        {{ group.codeLocationGroupe }} - {{ group.lib_LocationGroupe }}
      </option>
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700">EWM Code Storage Type</label>
    <select [(ngModel)]="selectedBin.ewm_Code_StorageType" name="ewm_Code_StorageType"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      <option value="">Select Storage Type</option>
      <option *ngFor="let type of storageTypes" [value]="type.code">
        {{ type.code }} - {{ type.lib }}
      </option>
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700">Code Storage Bin Type</label>
    <select [(ngModel)]="selectedBin.codeStorageBinType" name="codeStorageBinType"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      <option value="">Select Bin Type</option>
      <option *ngFor="let binType of binTypes" [value]="binType.codeStorageBinType">
        {{ binType.codeStorageBinType }} - {{ binType.lib_LocationType }}
      </option>
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700">Code EWM Display Parck Groupe</label>
    <select [(ngModel)]="selectedBin.codeEwm_DisplayParckGroupe" name="codeEwm_DisplayParckGroupe"
            class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      <option value="">Select Parck Display Groupe</option>
      <option *ngFor="let group of parckGroups" [value]="group.code">
        {{ group.code }} - {{ group.libelle }}
      </option>
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700">Capacity</label>
    <input type="number" [(ngModel)]="selectedBin.capacity" name="capacity"
           class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
           placeholder="Enter capacity" required>
  </div>

  <!-- Checkbox options -->
  <div class="col-span-1 sm:col-span-2 flex flex-col space-y-2 mt-2">
    <label class="flex items-center">
      <input type="checkbox" [(ngModel)]="selectedBin.qualityValidationMadatoryToAssign" name="qualityValidationMadatoryToAssign"
             class="mr-2 h-4 w-4 text-blue-500 focus:ring-blue-500"> Quality Validation Mandatory
    </label>
    <label class="flex items-center">
      <input type="checkbox" [(ngModel)]="selectedBin.staticLocation" name="staticLocation"
             class="mr-2 h-4 w-4 text-blue-500 focus:ring-blue-500"> Static Location
    </label>
    <label class="flex items-center">
      <input type="checkbox" [(ngModel)]="selectedBin.dynamicLocation" name="dynamicLocation"
             class="mr-2 h-4 w-4 text-blue-500 focus:ring-blue-500"> Dynamic Location
    </label>
    <label class="flex items-center">
      <input type="checkbox" [(ngModel)]="selectedBin.exacticLocation" name="exacticLocation"
             class="mr-2 h-4 w-4 text-blue-500 focus:ring-blue-500"> Exact Location
    </label>
  </div>

  <!-- Form buttons -->
  <div class="col-span-1 sm:col-span-2 flex space-x-4 mt-2">
    <button type="submit"
            class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"
            [disabled]="!selectedBin.ewm_Lib_CodeLocation || !selectedBin.ewm_Code_StorageType || !selectedBin.codeStorageBinType || !selectedBin.codeEwm_DisplayParckGroupe || !selectedBin.capacity">
      {{ isEditing ? 'Update Bin' : 'Create Bin' }}
    </button>
    <button type="button" (click)="toggleForm()"
            class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">
      Cancel
    </button>
  </div>
</form>

<!-- Existing Bins -->
<div class="mt-6">
  <h2 class="text-xl font-bold mb-2">Existing Storage Bins</h2>
  <div *ngIf="isLoading" class="text-center py-4 text-gray-500">Loading bins...</div>
  <div *ngIf="!isLoading && bins.length === 0" class="text-center py-4 text-gray-500">No bins found.</div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    <div *ngFor="let bin of bins" class="p-4 border rounded-lg shadow hover:shadow-md transition bg-white">
      <p><strong>Lib Code Location:</strong> {{ bin.ewm_Lib_CodeLocation }}</p>
      <p><strong>Group:</strong> {{ bin.codeLocationGroupe }}</p>
      <p><strong>Storage Type:</strong> 
        <span class="px-2 py-1 rounded text-white" [ngClass]="{
          'bg-blue-500': bin.ewm_Code_StorageType === 'STANDARD',
          'bg-green-500': bin.ewm_Code_StorageType === 'SPECIAL',
          'bg-yellow-500': bin.ewm_Code_StorageType === 'TEMP'
        }">{{ bin.ewm_Code_StorageType }}</span>
      </p>
      <p><strong>Bin Type:</strong> {{ bin.codeStorageBinType }}</p>
      <p><strong>Parck Display Group:</strong> {{ bin.codeEwm_DisplayParckGroupe }}</p>
      <p><strong>Capacity:</strong> {{ bin.capacity }}</p>
      <p><strong>Status:</strong> {{ bin.atorizedStatus }}</p>
      <div class="mt-2 flex space-x-2">
        <button (click)="editBin(bin)" class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition">Edit</button>
        <button (click)="deleteBin(bin.idewm_Location!)" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition">Delete</button>
      </div>
    </div>
  </div>
</div>

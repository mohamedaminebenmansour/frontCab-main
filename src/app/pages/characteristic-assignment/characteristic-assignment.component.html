<!-- src/app/pages/characteristic-assignment/characteristic-assignment.component.html -->
<div class="p-4">
    <h2 class="text-2xl font-bold mb-4">Characteristic Assignments Management</h2>

    <p-button label="Create New" icon="pi pi-plus" (click)="openCreateDialog()" class="mb-4"></p-button>

    <p-table [value]="assignments()" responsiveLayout="scroll" [paginator]="true" [rows]="10">
        <ng-template pTemplate="header">
            <tr>
                <th>ID</th>
                <th>Material ID</th>
                <th>Characteristic ID</th>
                <th>Value Range</th>
                <th>Default Value</th>
                <th>Unit</th>
                <th>Required</th>
                <th>Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-assignment>
            <tr>
                <td>{{ assignment.id }}</td>
                <td>{{ assignment.materialId }}</td>
                <td>{{ assignment.characteristicId }}</td>
                <td>{{ assignment.valueRange }}</td>
                <td>{{ assignment.defaultValue }}</td>
                <td>{{ assignment.unitOfMeasure }}</td>
                <td>{{ assignment.isRequired ? 'Yes' : 'No' }}</td>
                <td class="flex space-x-2">
                    <p-button icon="pi pi-pencil" (click)="openEditDialog(assignment)"
                        styleClass="p-button-rounded p-button-success" pTooltip="Edit"></p-button>
                    <p-button icon="pi pi-trash" (click)="deleteAssignment(assignment)"
                        styleClass="p-button-rounded p-button-danger" pTooltip="Delete"></p-button>
                </td>
            </tr>
        </ng-template>
    </p-table>

    <!-- Form Dialog for Create/Edit -->
    <p-dialog [header]="isEditMode() ? 'Edit Assignment' : 'Create Assignment'" [visible]="displayFormDialog()"
        (visibleChange)="displayFormDialog.set($event)" [modal]="true" [style]="{width: '50vw'}">
        <form [formGroup]="assignmentForm" class="grid grid-cols-2 gap-4">
            <div>
                <label for="materialId" class="block mb-1 font-medium">Material</label>
                <select id="materialId" formControlName="materialId" (change)="onMaterialChange($event)"
                    class="w-full rounded-md border p-2">
                    <option value="">Select Material</option>
                    <option *ngFor="let material of materials()" [value]="material.id">{{ material.materialNumber }}
                    </option>
                </select>
            </div>
            <div *ngIf="assignmentForm.get('materialId')?.value">
                <label for="characteristicId" class="block mb-1 font-medium">Characteristic</label>
                <select id="characteristicId" formControlName="characteristicId" class="w-full rounded-md border p-2">
                    <option value="">Select Characteristic</option>
                    <option *ngFor="let char of availableCharacteristics()" [value]="char.id">{{
                        char.characteristicNumber }}</option>
                </select>
            </div>
            <div>
                <label for="valueRange" class="block mb-1 font-medium">Value Range</label>
                <input type="text" id="valueRange" formControlName="valueRange" class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="defaultValue" class="block mb-1 font-medium">Default Value</label>
                <input type="text" id="defaultValue" formControlName="defaultValue"
                    class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="unitOfMeasure" class="block mb-1 font-medium">Unit of Measure</label>
                <input type="text" id="unitOfMeasure" formControlName="unitOfMeasure"
                    class="w-full rounded-md border p-2" />
            </div>
            <div class="flex items-center">
                <p-checkbox id="isRequired" formControlName="isRequired" binary="true"></p-checkbox>
                <label for="isRequired" class="ml-2 font-medium">Is Required</label>
            </div>
        </form>
        <ng-template pTemplate="footer">
            <p-button label="Save" icon="pi pi-check" (click)="saveAssignment()"
                styleClass="p-button-success"></p-button>
            <p-button label="Cancel" icon="pi pi-times" (click)="displayFormDialog.set(false)"
                styleClass="p-button-secondary"></p-button>
        </ng-template>
    </p-dialog>

    <p-confirmDialog></p-confirmDialog>
    <p-toast></p-toast>
</div>
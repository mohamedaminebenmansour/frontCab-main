<div class="container mx-auto p-6 space-y-8">

  <!-- ✅ Alert -->
  <div *ngIf="alertMessage" class="flex items-center justify-between p-4 rounded-xl text-white shadow-md animate-fade-slide"
       [ngClass]="{'bg-green-500': alertType==='success','bg-red-500': alertType==='error'}">
    <span>{{ alertMessage }}</span>
    <button (click)="alertMessage=null; alertType=null" class="underline hover:text-gray-200 transition">Dismiss</button>
  </div>

  <!-- 🏷️ Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Storage Bin Details</h1>
    <button (click)="toggleForm()"
            class="flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-md hover:shadow-lg hover:opacity-95 transition-all duration-200">
      <i class="fa" [ngClass]="isFormVisible ? 'fa-times' : 'fa-plus'"></i>
      {{ isFormVisible ? 'Cancel' : 'Add New Detail' }}
    </button>
  </div>

  <!-- 🧾 Form -->
  <form *ngIf="isFormVisible" (ngSubmit)="saveDetail()"
        class="mt-4 bg-white p-6 rounded-2xl shadow-lg border border-gray-100 space-y-6 animate-fade-slide">
    
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">EWM Code Location</label>
        <select [(ngModel)]="selectedDetail.ewm_CodeLocation" name="ewm_CodeLocation"
                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition" required>
          <option value="">Select Storage Bin</option>
          <option *ngFor="let bin of storageBins" [value]="bin.ewm_Lib_CodeLocation">
            {{ bin.ewm_Lib_CodeLocation }} (Type: {{ bin.ewm_Code_StorageType }})
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Sequence In Location</label>
        <input type="number" [(ngModel)]="selectedDetail.sequenceInLocation" name="sequenceInLocation"
               placeholder="Enter sequence (e.g., 1)"
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
               required>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Stockage Date</label>
        <input type="date" [(ngModel)]="selectedDetail.stockageDate" name="stockageDate"
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
        <select [(ngModel)]="selectedDetail.status" name="status"
                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
          <option value="">Select Status</option>
          <option value="0">Empty</option>
          <option value="1">Full</option>
          <option value="2">Partial</option>
          <option value="3">Reserved</option>
          <option value="4">Blocked</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Item</label>
        <input [(ngModel)]="selectedDetail.item" name="item"
               placeholder="Enter item"
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Serial Number</label>
        <input [(ngModel)]="selectedDetail.serialNumber" name="serialNumber"
               placeholder="Enter serial number"
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Handling Unit</label>
        <input [(ngModel)]="selectedDetail.handlingUnit" name="handlingUnit"
               placeholder="Enter handling unit"
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Production Date</label>
        <input type="date" [(ngModel)]="selectedDetail.productionDate" name="productionDate"
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Initial Qty</label>
        <input type="number" [(ngModel)]="selectedDetail.initialQty" name="initialQty"
               placeholder="Enter initial qty" required
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Actual Qty</label>
        <input type="number" [(ngModel)]="selectedDetail.actualQty" name="actualQty"
               placeholder="Enter actual qty" required
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Initial Weight</label>
        <input type="number" [(ngModel)]="selectedDetail.initialWeight" name="initialWeight"
               placeholder="Enter initial weight" required
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Actual Weight</label>
        <input type="number" [(ngModel)]="selectedDetail.actualWeight" name="actualWeight"
               placeholder="Enter actual weight" required
               class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
      </div>

    </div>

    <div class="flex flex-wrap gap-4 justify-end mt-4">
      <button type="submit"
              class="px-5 py-2 rounded-lg bg-green-500 text-white font-medium hover:bg-green-600 transition"
              [disabled]="!selectedDetail.ewm_CodeLocation || !selectedDetail.sequenceInLocation || !selectedDetail.initialQty || !selectedDetail.actualQty || !selectedDetail.initialWeight || !selectedDetail.actualWeight">
        {{ isEditing ? 'Update Detail' : 'Create Detail' }}
      </button>
      <button type="button" (click)="toggleForm()"
              class="px-5 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
        Cancel
      </button>
    </div>

  </form>

  <!-- 📋 List of Details -->
  <div class="mt-6 space-y-4">
    <h2 class="text-xl font-bold">Existing Storage Bin Details</h2>

    <div *ngIf="isLoading" class="text-center py-4 text-gray-500">Loading details...</div>
    <div *ngIf="!isLoading && details.length===0" class="text-center py-4 text-gray-500">No details found.</div>

    <div *ngFor="let detail of details"
         class="p-4 rounded-2xl shadow hover:shadow-lg transition border border-gray-100 bg-white space-y-1 animate-fade-slide">
      <p><span class="font-semibold">EWM Code Location:</span> {{ detail.ewm_CodeLocation }}</p>
      <p><span class="font-semibold">Sequence In Location:</span> {{ detail.sequenceInLocation }}</p>
      <p><span class="font-semibold">Stockage Date:</span> {{ detail.stockageDate }}</p>
      <p><span class="font-semibold">Status:</span> {{ detail.status }}</p>
      <p><span class="font-semibold">Item:</span> {{ detail.item }}</p>
      <p><span class="font-semibold">Serial Number:</span> {{ detail.serialNumber }}</p>
      <p><span class="font-semibold">Handling Unit:</span> {{ detail.handlingUnit }}</p>
      <p><span class="font-semibold">Production Date:</span> {{ detail.productionDate }}</p>
      <p><span class="font-semibold">Initial Qty:</span> {{ detail.initialQty }}</p>
      <p><span class="font-semibold">Actual Qty:</span> {{ detail.actualQty }}</p>
      <p><span class="font-semibold">Initial Weight:</span> {{ detail.initialWeight }}</p>
      <p><span class="font-semibold">Actual Weight:</span> {{ detail.actualWeight }}</p>

      <div class="mt-3 flex flex-wrap gap-2 justify-end">
        <button (click)="editDetail(detail)"
                class="px-3 py-1 rounded-lg bg-yellow-500 text-white hover:bg-yellow-600 transition">
          Edit
        </button>
        <button (click)="deleteDetail(detail.idLocation_Details!)"
                class="px-3 py-1 rounded-lg bg-red-500 text-white hover:bg-red-600 transition">
          Delete
        </button>
      </div>
    </div>
  </div>

</div>

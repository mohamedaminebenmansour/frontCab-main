<!-- src/app/pages/classification/classification.component.html -->

<div class="p-4">
    <h2 class="text-2xl font-bold mb-4">Classifications Management</h2>

    <p-button label="Create New" icon="pi pi-plus" (click)="openCreateDialog()" class="mb-4"></p-button>

    <p-table [value]="classifications()" responsiveLayout="scroll" [paginator]="true" [rows]="10">
        <ng-template pTemplate="header">
            <tr>
                <th>ID</th>
                <th>Class Number</th>
                <th>Class Name</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-classification>
            <tr>
                <td>{{ classification.id }}</td>
                <td>{{ classification.classNumber }}</td>
                <td>{{ classification.className }}</td>
                <td>{{ getStatusLabel(classification.classStatus) }}</td>
                <td class="flex space-x-2">
                    <p-button icon="pi pi-pencil" (click)="openEditDialog(classification)"
                        styleClass="p-button-rounded p-button-success" pTooltip="Edit"></p-button>
                    <p-button icon="pi pi-trash" (click)="deleteClassification(classification)"
                        styleClass="p-button-rounded p-button-danger" pTooltip="Delete"></p-button>
                    <p-button icon="pi pi-plus-circle" (click)="openCharDialog(classification, true)"
                        styleClass="p-button-rounded p-button-info" pTooltip="Assign Characteristic"></p-button>
                    <p-button icon="pi pi-minus-circle" (click)="openCharDialog(classification, false)"
                        styleClass="p-button-rounded p-button-warning" pTooltip="Remove Characteristic"></p-button>
                </td>
            </tr>
            <tr *ngIf="selectedClassification()?.id === classification.id">
                <td colspan="5">
                    <div class="p-2 bg-gray-100 rounded-md">
                        <h3 class="text-lg font-semibold">Details:</h3>
                        <p>Description: {{ classification.classDescription }}</p>
                        <p>Group: {{ classification.classGroup }}</p>
                        <p>Hierarchy: {{ classification.classHierarchy }}</p>
                        <p>Usage: {{ classification.classUsage }}</p>
                        <p>Authorization Group: {{ classification.classAuthorizationGroup }}</p>
                        <p>Key Date: {{ classification.classKeyDate | date:'yyyy-MM-dd' }}</p>
                        <p>Validity Start: {{ classification.validityStartDate | date:'yyyy-MM-dd' }}</p>
                        <p>Validity End: {{ classification.validityEndDate | date:'yyyy-MM-dd' }}</p>
                        <h3 class="text-lg font-semibold">Characteristics:</h3>
                        <ul class="list-disc pl-5">
                            <li *ngFor="let char of classification.characteristics">
                                {{ char.characteristicNumber }} - {{ char.characteristicName }}
                            </li>
                        </ul>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>

    <!-- Form Dialog -->
    <p-dialog [header]="isEditMode() ? 'Edit Classification' : 'Create Classification'" [visible]="displayFormDialog()"
        (visibleChange)="displayFormDialog.set($event)" [modal]="true" [style]="{width: '50vw'}">
        <form [formGroup]="classificationForm" class="grid grid-cols-2 gap-4">
            <div>
                <label for="classNumber" class="block mb-1 font-medium">Class Number</label>
                <input type="text" id="classNumber" formControlName="classNumber"
                    class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="className" class="block mb-1 font-medium">Class Name</label>
                <input type="text" id="className" formControlName="className" class="w-full rounded-md border p-2" />
            </div>
            <div class="col-span-2">
                <label for="classDescription" class="block mb-1 font-medium">Description</label>
                <textarea id="classDescription" formControlName="classDescription" class="w-full rounded-md border p-2"
                    rows="4"></textarea>
            </div>
            <div>
                <label for="classStatus" class="block mb-1 font-medium">Status</label>
                <select id="classStatus" formControlName="classStatus" class="w-full rounded-md border p-2">
                    <option *ngFor="let opt of classStatusOptions" [value]="opt.value">{{ opt.label }}</option>
                </select>
            </div>
            <div>
                <label for="classGroup" class="block mb-1 font-medium">Group</label>
                <input type="text" id="classGroup" formControlName="classGroup" class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="classHierarchy" class="block mb-1 font-medium">Hierarchy</label>
                <input type="text" id="classHierarchy" formControlName="classHierarchy"
                    class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="classUsage" class="block mb-1 font-medium">Usage</label>
                <input type="text" id="classUsage" formControlName="classUsage" class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="classKeyDate" class="block mb-1 font-medium">Key Date</label>
                <input type="date" id="classKeyDate" formControlName="classKeyDate"
                    class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="validityStartDate" class="block mb-1 font-medium">Validity Start</label>
                <input type="date" id="validityStartDate" formControlName="validityStartDate"
                    class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="validityEndDate" class="block mb-1 font-medium">Validity End</label>
                <input type="date" id="validityEndDate" formControlName="validityEndDate"
                    class="w-full rounded-md border p-2" />
            </div>
            <div>
                <label for="isInherited" class="block mb-1 font-medium">Is Inherited</label>
                <p-checkbox id="isInherited" formControlName="isInherited" [binary]="true"></p-checkbox>
            </div>
            <div>
                <label for="classAuthorizationGroup" class="block mb-1 font-medium">Authorization Group</label>
                <input type="text" id="classAuthorizationGroup" formControlName="classAuthorizationGroup"
                    class="w-full rounded-md border p-2" />
            </div>
        </form>
        <ng-template pTemplate="footer">
            <p-button label="Save" icon="pi pi-check" (click)="saveClassification()"
                styleClass="p-button-success"></p-button>
            <p-button label="Cancel" icon="pi pi-times" (click)="displayFormDialog.set(false)"
                styleClass="p-button-secondary"></p-button>
        </ng-template>
    </p-dialog>

    <!-- Characteristic Management Dialog -->
    <p-dialog [header]="isAssignMode() ? 'Assign Characteristic' : 'Remove Characteristic'"
        [visible]="displayCharDialog()" (visibleChange)="displayCharDialog.set($event)" [modal]="true"
        [style]="{width: '30vw'}">
        <div>
            <label for="charNumber" class="block mb-1 font-medium">Characteristic</label>
            <select id="charNumber" [ngModel]="selectedCharNumber()" (ngModelChange)="selectedCharNumber.set($event)"
                class="w-full rounded-md border p-2">
                <option value="" disabled selected>Select a characteristic</option>
                <option *ngFor="let opt of isAssignMode() ? characteristicsForAssign() : characteristicsForRemove()"
                    [value]="opt.value">{{ opt.label }}</option>
            </select>
        </div>
        <ng-template pTemplate="footer">
            <p-button label="Submit" icon="pi pi-check" (click)="manageCharacteristic()"
                styleClass="p-button-success"></p-button>
            <p-button label="Cancel" icon="pi pi-times" (click)="displayCharDialog.set(false)"
                styleClass="p-button-secondary"></p-button>
        </ng-template>
    </p-dialog>

    <p-confirmDialog></p-confirmDialog>
    <p-toast></p-toast>
</div>
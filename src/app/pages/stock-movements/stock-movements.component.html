<div class="container mx-auto p-6">

  <!-- Alert -->
  <div *ngIf="alertMessage" class="p-4 mb-6 rounded-lg text-white flex justify-between items-center"
       [ngClass]="{
         'bg-green-500': alertType === 'success',
         'bg-red-500': alertType === 'error'
       }">
    <span>{{ alertMessage }}</span>
    <button (click)="alertMessage=null; alertType=null"
            class="underline text-white hover:text-gray-200 transition">Dismiss</button>
  </div>

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Stock Movements</h1>
    <button (click)="toggleForm()"
            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
      {{ isFormVisible ? 'Cancel' : 'Add New Movement' }}
    </button>
  </div>

  <!-- Form -->
  <form *ngIf="isFormVisible" (ngSubmit)="saveMovement()"
        class="bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-lg space-y-6">

    <h2 class="text-lg font-semibold text-gray-700 dark:text-gray-200">Movement Details</h2>

    <div class="grid grid-cols-1 gap-4 md:grid-cols-2">

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Movement Type</label>
        <input [(ngModel)]="selectedMovement.movementType" name="movementType"
               class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Enter movement type" required />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Source Bin</label>
        <select [(ngModel)]="selectedMovement.sourceBinCode" name="sourceBinCode"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required>
          <option value="">Select Source Bin</option>
          <option *ngFor="let bin of storageBins" [value]="bin.ewm_Lib_CodeLocation">
            {{ bin.ewm_Lib_CodeLocation }} ({{ bin.ewm_Code_StorageType }})
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Destination Bin</label>
        <select [(ngModel)]="selectedMovement.destinationBinCode" name="destinationBinCode"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required>
          <option value="">Select Destination Bin</option>
          <option *ngFor="let bin of storageBins" [value]="bin.ewm_Lib_CodeLocation">
            {{ bin.ewm_Lib_CodeLocation }} ({{ bin.ewm_Code_StorageType }})
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Handling Unit</label>
        <select [(ngModel)]="selectedMovement.handlingUnitID" name="handlingUnitID"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required>
          <option value="">Select Handling Unit</option>
          <option *ngFor="let unit of handlingUnits" [value]="unit.idHandlingUnit">
            {{ unit.serialNumber }} ({{ unit.item }})
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Moved Quantity</label>
        <input type="number" [(ngModel)]="selectedMovement.movedQty" name="movedQty"
               class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Enter quantity" required />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Movement Date</label>
        <input type="date" [(ngModel)]="selectedMovement.movementDate" name="movementDate"
               class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               required />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Executed By</label>
        <input [(ngModel)]="selectedMovement.executedBy" name="executedBy"
               class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Enter executor" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Status</label>
        <select [(ngModel)]="selectedMovement.status" name="status"
                class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                required>
          <option value="">Select Status</option>
          <option value="Completed">Completed</option>
          <option value="Pending">Pending</option>
          <option value="Cancelled">Cancelled</option>
          <option value="In Progress">In Progress</option>
        </select>
      </div>

    </div>

    <div class="flex gap-4 mt-4">
      <button type="submit"
              class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
              [disabled]="!selectedMovement.movementType || !selectedMovement.sourceBinCode || !selectedMovement.destinationBinCode || !selectedMovement.handlingUnitID || !selectedMovement.movedQty || !selectedMovement.movementDate || !selectedMovement.status">
        {{ isEditing ? 'Update Movement' : 'Create Movement' }}
      </button>
      <button type="button" (click)="toggleForm()"
              class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
        Cancel
      </button>
    </div>
  </form>

  <!-- Movements List -->
  <div class="mt-6">
    <h2 class="text-lg font-bold text-gray-800 mb-3">Existing Stock Movements</h2>
    <div *ngIf="isLoading" class="text-center py-4 text-gray-500">Loading movements...</div>
    <div *ngIf="!isLoading && movements.length === 0" class="text-center py-4 text-gray-500">No movements found.</div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div *ngFor="let movement of movements" class="p-4 bg-white dark:bg-gray-900 border rounded-2xl shadow hover:shadow-lg transition">
        <p><strong>Type:</strong> {{ movement.movementType }}</p>
        <p><strong>From:</strong> {{ movement.sourceBinCode }}</p>
        <p><strong>To:</strong> {{ movement.destinationBinCode }}</p>
        <p><strong>Unit:</strong> {{ movement.handlingUnitID }}</p>
        <p><strong>Qty:</strong> {{ movement.movedQty }}</p>
        <p><strong>Date:</strong> {{ movement.movementDate }}</p>
        <p><strong>By:</strong> {{ movement.executedBy }}</p>
        <p><strong>Status:</strong> <span class="capitalize">{{ movement.status }}</span></p>
        <div class="flex gap-2 mt-3">
          <button (click)="editMovement(movement)"
                  class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition">Edit</button>
          <button (click)="deleteMovement(movement.idStockMovement!)"
                  class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition">Delete</button>
        </div>
      </div>
    </div>
  </div>

</div>
